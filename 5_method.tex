% vim: set tabstop=4 :
%**********************************************************
%\chapter{提案手法にあたる章}
%\chapter{格子分割を用いた進行方向計算の削減手法}
\chapter{格子分割による進行方向ベクトル計算の削減手法}
\label{sec:method}
%**********************************************************
\section{本章の概要}
SFMの運動方程式は，エージェントの位置が変わるたびに，
目的地までのベクトルを表す$e$や周囲のエージェントを避ける力$f_{ij}$，
障害物を避ける力$f_{iW}$の再計算が必要となる．
周囲のエージェントを避ける力$f_{ij}$の計算は，時間ステップごとにすべての
エージェントの位置が変化するため，解析中のみに計算が可能である．
一方，ベクトル$e$や障害物を避ける力$f_{iW}$は，エージェントの位置に
応じて決定し，壁や机などの障害物の座標が固定であることから，解析前に計算が可能である．

そこで，本論文では，格子状に分割した領域ごとにベクトル$e$と障害物を避ける力$f_{iW}$を
あらかじめ計算することで，解析中の進行方向の再計算を削減する．

\section{格子分割を用いた進行方向ベクトル$e$の計算方法}
進行方向ベクトル$e$は，目的地に進むベクトルであり，エージェントの座標から
目的地の座標までのベクトルである．
このため，ベクトル$e$は解析領域を格子状に分割した領域ごとの中心座標から
目的地の座標までのベクトルを計算することで，解析前に計算が可能となる．
\figref{fig:grid_ex1}に格子分割した進行方向の例を示す．
%
\figh{提案する格子分割の例}{9}{ex1.eps}{grid_ex1}
%
\figref{fig:ex1}中の○はエージェントであり，エージェントA，Bが1つの目的地に向かう
様子である．
図中のエージェントBは，エージェントAの位置に移動したとき，エージェントAと同じ進行方向に
なる．
このため，解析領域を分割し，格子ごとに進行方向を算出することで，解析中の
進行方向の再計算が削減できる.	
格子ごとの進行方向は，格子の中心座標から目的地までのベクトル$e$を求め，配列に格納する．
進行方向は，経由地ごとに異なるため，経由地ごとに違う配列に格納する必要がある．
経由地ごとに

%%工事中

\section{格子分割を用いた障害物を避ける力$F_{iW}$の計算方法}

格子ごとの進行方向は，格子の中心座標から目的地までのベクトル$e$を求め，配列に格納する．同様に，
壁から受ける力$f_{iW}$は，解析中に机や壁が動かない特徴を利用し，格子ごとの中心座標を用いて，
$f_{iW}$をあらかじめ算出する．
目的地や障害物が存在する格子では，正しく目的地に進むように，0ベクトルを格納する．0ベクトルが格納されている格子中に存在する
エージェントは，エージェントごとに本来のSFMと同様に進行方向を計算する．
目的地の他に経由地が複数存在する場合は，\figref{fig:ex2}に示すように，経由地ごとに進行方向を
設定する．
\figref{fig:ex2}の例では，目的地に向かっているエージェントは，目的地の進行方向が格納されている配列を
参照し，経由地に向かっているエージェントは，経由地の進行方向が格納されている配列を参照する．

\figref{fig:5_teian_flow1}に提案手法の解析全体のフローチャートを示す．
\figref{fig:5_teian_flow1}中の前処理は，提案手法に必要である格子ごとの進行方向や
壁を避ける力を算出する．
\figref{fig:5_teian_flow2}に提案手法の前処理のフローチャートを示す．
\figref{fig:5_teian_flow2}に示すように，提案手法は，進行方向のベクトル$e$を
格納する配列と壁を避ける力$F_W$を格納する配列が必要となる．
各配列の計算は，\figref{fig:5_teian_flow2}のように格子ごとにあらかじめ計算する．
進行方向のベクトル$e$を格納する配列中の要素は，\figref{fig:ex2}のように経由地ごとに
違うため，それぞれの経由地で計算する必要となる．
このため，進行方向ベクトル$e$を格納する配列の前処理は，経由地数の多さや
格子サイズの細かさに応じて計算回数が増加する．
\figref{fig:5_teian_flow2}中の壁を避ける力$f_{iw}$を格納する配列は，
経由地が変わっても変化しないため，解析領域全体で一つとなる．
このため，壁を避ける力$f_{iw}$を格納する配列の前処理は，格子サイズの細かさに応じて
計算回数が増加する．

\figtb{経由地がある場合の進行方向の例}{An example of proposed method with waypoints.}{7}{ex2.eps}{ex2}
\figtb{提案手法の解析全体のフローチャート}{}{5}{5_teian_flow1.eps}{5_teian_flow1}
\figtb{提案手法の前処理のフローチャート}{}{5}{5_teian_flow2.eps}{5_teian_flow2}
\figtb{提案手法の運動方程式計算のフローチャート}{}{9}{5_teian_flow3.eps}{5_teian_flow2}

\section{評価}

\section{本章のまとめ}
%***** END ************************************************
